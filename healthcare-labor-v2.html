<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Healthcare Labor Trends (v2) | Clinicians.fyi</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_import/occupation-search.da7dbb87.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_import/occupation-search.da7dbb87.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/arquero@5.4.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3@7.9.0/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/duckdb.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/@observablehq/plot@0.6.14/_esm.js">
<link rel="modulepreload" href="./_npm/topojson-client@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/@duckdb/duckdb-wasm@1.28.0/_esm.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="modulepreload" href="./_npm/apache-arrow@15.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/acorn@8.11.3/_esm.js">
<link rel="modulepreload" href="./_npm/d3-array@3.2.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-axis@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-brush@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-chord@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-color@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-contour@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-delaunay@6.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/d3-dispatch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-drag@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-ease@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-fetch@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-force@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-format@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-geo@3.1.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-hierarchy@3.1.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-interpolate@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-path@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-polygon@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-quadtree@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-random@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale@4.0.2/_esm.js">
<link rel="modulepreload" href="./_npm/d3-scale-chromatic@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-selection@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-shape@3.2.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time@3.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-time-format@4.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/d3-timer@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-transition@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/d3-zoom@3.0.0/_esm.js">
<link rel="modulepreload" href="./_npm/interval-tree-1d@1.0.4/_esm.js">
<link rel="modulepreload" href="./_npm/apache-arrow@16.1.0/_esm.js">
<link rel="modulepreload" href="./_npm/tslib@2.6.2/_esm.js">
<link rel="modulepreload" href="./_npm/flatbuffers@23.5.26/_esm.js">
<link rel="modulepreload" href="./_npm/internmap@2.0.3/_esm.js">
<link rel="modulepreload" href="./_npm/delaunator@5.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/binary-search-bounds@2.0.5/_esm.js">
<link rel="modulepreload" href="./_npm/flatbuffers@24.3.25/_esm.js">
<link rel="modulepreload" href="./_npm/robust-predicates@3.0.2/_esm.js">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile, FileAttachment} from "./_observablehq/stdlib.js";
import {registerTable} from "./_observablehq/stdlib/duckdb.js";

registerFile("./data/oes/processed/naics_lookup_from_data.csv", {"name":"./data/oes/processed/naics_lookup_from_data.csv","mimeType":"text/csv","path":"./_file/data/oes/processed/naics_lookup_from_data.0a57814f.csv","lastModified":1720724332694});
registerFile("./data/oes/processed/occ_code.csv", {"name":"./data/oes/processed/occ_code.csv","mimeType":"text/csv","path":"./_file/data/oes/processed/occ_code.6848eccf.csv","lastModified":1720323702095});
registerFile("./data/oes/processed/oes_longitudinal_slim.parquet", {"name":"./data/oes/processed/oes_longitudinal_slim.parquet","path":"./_file/data/oes/processed/oes_longitudinal_slim.30d9d5bc.parquet","lastModified":1720323702068});
registerFile("./data/oes/processed/oews_estimates_slim.parquet", {"name":"./data/oes/processed/oews_estimates_slim.parquet","path":"./_file/data/oes/processed/oews_estimates_slim.2e1882bd.parquet","lastModified":1720671094105});
registerFile("./data/oes/processed/state_lookup.csv", {"name":"./data/oes/processed/state_lookup.csv","mimeType":"text/csv","path":"./_file/data/oes/processed/state_lookup.d5b680d9.csv","lastModified":1720723183346});
registerFile("./dataloaders/counties-10m.json", {"name":"./dataloaders/counties-10m.json","mimeType":"application/json","path":"./_file/dataloaders/counties-10m.145aaf5d.json","lastModified":1712986955947});
registerTable("oes_db", FileAttachment("./data/oes/processed/oes_longitudinal_slim.parquet"));
registerTable("oews_estimates", FileAttachment("./data/oes/processed/oews_estimates_slim.parquet"));

define({id: "ba6a16f1", inputs: ["FileAttachment"], outputs: ["occ_codes","naics_lookup","state_lookup"], body: (FileAttachment) => {
const occ_codes = FileAttachment("./data/oes/processed/occ_code.csv").csv()
const naics_lookup = FileAttachment("./data/oes/processed/naics_lookup_from_data.csv").csv()
const state_lookup = FileAttachment("./data/oes/processed/state_lookup.csv").csv()
return {occ_codes,naics_lookup,state_lookup};
}});

define({id: "520c85fa", inputs: ["occ_codes"], outputs: ["lookup_occ_title"], body: (occ_codes) => {
// Lookup function OCC Codes (code to title)
const lookup_occ_title = occ_code => 
  occ_codes.find(({ OCC_CODE }) => OCC_CODE === occ_code)?.OCC_TITLE;
return {lookup_occ_title};
}});

define({id: "42afef24", inputs: ["naics_lookup"], outputs: ["lookup_naics_title"], body: (naics_lookup) => {
// Lookup function for NAICS codes
const lookup_naics_title = naics_code => 
  naics_lookup.find(({ NAICS }) => NAICS === naics_code)?.NAICS_TITLE ?? naics_code;
return {lookup_naics_title};
}});

define({id: "c0d0c1a5", inputs: ["state_lookup"], outputs: ["lookup_state_name"], body: (state_lookup) => {
// Lookup function for NAICS codes
const lookup_state_name = code => 
  state_lookup.find(({ AREA }) => AREA === String(code).padStart(2, '0'))?.AREA_TITLE ?? code;
return {lookup_state_name};
}});

define({id: "c4f6bdfb", inputs: ["sql","sql_array_str"], outputs: ["get_naics_counts"], body: (sql,sql_array_str) => {
const get_naics_counts = async function (selected_codes, grouping_limit=5) {
  const other_industries_label = grouping_limit > 0 ? "Other Industries" : "All Industries";
  const other_industries_code = grouping_limit > 0 ? "Other" : "All Industries";
  const naics_occ_count = await sql([
    `WITH all_time_ranked_data AS (
  SELECT 
    NAICS,
    ANY_VALUE(NAICS_TITLE) AS NAICS_TITLE,
    SUM(TOT_EMP) AS all_time_total_employment,
    RANK() OVER (ORDER BY SUM(TOT_EMP) DESC) AS all_time_rank
  FROM oes_db
  WHERE OCC_CODE IN (${sql_array_str(selected_codes)}) 
    AND RIGHT(OCC_CODE, 1) != '0'
  GROUP BY NAICS
),
top_x_naics AS (
  SELECT NAICS
  FROM all_time_ranked_data
  WHERE all_time_rank <= ${grouping_limit}
),
monthly_data AS (
  SELECT 
    REPORT_DATE,
    NAICS,
    ANY_VALUE(NAICS_TITLE) AS NAICS_TITLE,
    SUM(TOT_EMP) AS total_employment
  FROM oes_db
  WHERE OCC_CODE IN (${sql_array_str(selected_codes)}) 
    AND RIGHT(OCC_CODE, 1) != '0'
  GROUP BY REPORT_DATE, NAICS
),
final_data AS (
  SELECT
    md.REPORT_DATE,
    CASE 
      WHEN txn.NAICS IS NOT NULL THEN md.NAICS 
      ELSE '${other_industries_code}'
    END AS NAICS,
    CASE 
      WHEN txn.NAICS IS NOT NULL THEN md.NAICS_TITLE
      ELSE '${other_industries_label}'
    END AS NAICS_TITLE,
    SUM(md.total_employment) AS total_employment
  FROM monthly_data md
  LEFT JOIN top_x_naics txn ON md.NAICS = txn.NAICS
  GROUP BY 
    md.REPORT_DATE,
    CASE 
      WHEN txn.NAICS IS NOT NULL THEN md.NAICS 
      ELSE '${other_industries_code}'
    END,
    CASE 
      WHEN txn.NAICS IS NOT NULL THEN md.NAICS_TITLE
      ELSE '${other_industries_label}'
    END
),
final_data_with_changes AS (
  SELECT 
    fd.*,
    fd.total_employment - LAG(fd.total_employment) OVER (PARTITION BY fd.NAICS ORDER BY fd.REPORT_DATE) AS change_since_previous,
    CASE 
      WHEN LAG(fd.total_employment) OVER (PARTITION BY fd.NAICS ORDER BY fd.REPORT_DATE) = 0 THEN NULL
      ELSE (fd.total_employment - LAG(fd.total_employment) OVER (PARTITION BY fd.NAICS ORDER BY fd.REPORT_DATE)) / LAG(fd.total_employment) OVER (PARTITION BY fd.NAICS ORDER BY fd.REPORT_DATE) * 100
    END AS percent_change_since_previous
  FROM final_data fd
)
SELECT 
  REPORT_DATE,
  NAICS,
  NAICS_TITLE,
  total_employment,
  change_since_previous,
  ROUND(percent_change_since_previous, 2) AS percent_change_since_previous,
FROM final_data_with_changes
ORDER BY 
  REPORT_DATE,
  CASE WHEN NAICS = 'Other' THEN 2 ELSE 1 END,
  total_employment DESC`
  ])
  
  return await naics_occ_count
}
return {get_naics_counts};
}});

define({id: "7e6c1cf3", inputs: ["Inputs","occ_codes","Generators"], outputs: ["occ_code_search_input","occ_code_search"], body: (Inputs,occ_codes,Generators) => {
// OCC Code search box
const occ_code_search_input = Inputs.search(occ_codes, {width: 100});
const occ_code_search = Generators.input(occ_code_search_input);
return {occ_code_search_input,occ_code_search};
}});

define({id: "2fa41573", inputs: ["Inputs","occ_code_search"], outputs: ["occ_code_table_input"], body: (Inputs,occ_code_search) => {
const occ_code_table_input = Inputs.table(
  occ_code_search,
  {
    align: {
      OCC_CODE: "left",
      OCC_TITLE: "left",
    },
    width: {
      OCC_CODE: 55,
    },
    header: {
      OCC_CODE: "Code",
      OCC_TITLE: "Title"
    },
    value: [""],
  }
);

return {occ_code_table_input};
}});

define({id: "8001c005", body: () => {
// const occ_code_table_input_results = Generators.input(occ_code_table_input);
}});

define({id: "250a25eb", body: () => {
// const dropdown_selected_codes = occ_code_table_input_results.map(d => d.OCC_CODE)
}});

define({id: "7c75a881", outputs: ["occupations"], body: () => {
// const selected_codes = Mutable(["29-1111", "29-1141"]);

const occupations = [
  {
    name: "Physicians",
    codes: [
      "29-1211", "29-1212", "29-1213", "29-1214", "29-1215", "29-1216", "29-1217", "29-1218",
      "29-1221", "29-1222", "29-1223", "29-1224", "29-1229", "29-1241", "29-1242", "29-1243",
      "29-1248", "29-1249",
      "29-1061", "29-1062", "29-1063", "29-1064", "29-1065", "29-1066", "29-1067", "29-1069",
    ]
  },
  {
    name: "Registered Nurses",
    codes: ["29-1111", "29-1141"]
  },
  {
    name: "Nurse Practitioners",
    codes: ["29-1171"]
  },
  {
    name: "Physician Assistants",
    codes: ["29-1071"]
  },
  {
    name: "Pharmacists",
    codes: ["29-1051"]
  },
  {
    name: "Dentists",
    codes: ["29-1021", "29-1022", "29-1023", "29-1024", "29-1029"]
  },
  {
    name: "Social Workers",
    codes: ["21-1021", "21-1022", "21-1023", "21-1029"]
  },
];
return {occupations};
}});

define({id: "fdda96c3", inputs: ["Inputs","htl"], outputs: ["grouping_limit_input"], body: (Inputs,htl) => {
const grouping_limit_input = Inputs.range([0, 20], 
  {
    step: 1, 
    value: 3,
    label: htl.html`<div style="border-bottom: 1px solid lightgray"><span class="muted">Number of Top Categories</span></div>`,
  }
)
return {grouping_limit_input};
}});

define({id: "6941ebb8", inputs: ["Generators","grouping_limit_input"], outputs: ["grouping_limit"], body: (Generators,grouping_limit_input) => {
const grouping_limit = Generators.input(grouping_limit_input)
return {grouping_limit};
}});

define({id: "43344edb", inputs: ["grouping_limit_input","display"], body: async (grouping_limit_input,display) => {
display(await(
grouping_limit_input
))
}});

define({id: "f93bf5b7", inputs: ["Inputs","occupations","htl"], outputs: ["selected_codes_input"], body: (Inputs,occupations,htl) => {
const selected_codes_input = Inputs.radio(occupations, {
  format: x => x.name,
  label: htl.html`<div style="border-bottom: 1px solid lightgray"><span class="muted">Select healthcare occupation</span></div>`,
  value: occupations[0]});
return {selected_codes_input};
}});

define({id: "9f6856b4", inputs: ["Generators","selected_codes_input"], outputs: ["selected_codes_hash"], body: (Generators,selected_codes_input) => {
const selected_codes_hash = Generators.input(selected_codes_input)
return {selected_codes_hash};
}});

define({id: "4ab5ef7d", inputs: ["selected_codes_hash"], outputs: ["selected_codes"], body: (selected_codes_hash) => {
const selected_codes = selected_codes_hash.codes
return {selected_codes};
}});

define({id: "2bbffbab", mode: "inline", inputs: ["selected_codes_input","display"], body: async (selected_codes_input,display) => {
display(await(
selected_codes_input
))
}});

define({id: "69b75b06", mode: "inline", inputs: ["selected_codes","html","lookup_occ_title","display"], body: async (selected_codes,html,lookup_occ_title,display) => {
display(await(
selected_codes.map((d) => html`<div style="font-size: 10pt; margin-left: 0px;"><a target="_blank" href="https://www.bls.gov/oes/current/oes${d.replace('-','')}.htm">${d}: ${lookup_occ_title(d)}</a></div>`)
))
}});

define({id: "b3b82386", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "cc2bfbd3", mode: "inline", inputs: ["overall_plot_object","display"], body: async (overall_plot_object,display) => {
display(await(
overall_plot_object
))
}});

define({id: "b3b82386-1", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "933fdb9a", mode: "inline", inputs: ["plot_object","display"], body: async (plot_object,display) => {
display(await(
plot_object
))
}});

define({id: "686c2ab9", inputs: ["counts_plot","get_naics_counts","selected_codes","grouping_limit"], outputs: ["plot_object"], body: async (counts_plot,get_naics_counts,selected_codes,grouping_limit) => {
const plot_object = counts_plot(await get_naics_counts(selected_codes, grouping_limit))
return {plot_object};
}});

define({id: "ea6a5532", inputs: ["counts_plot","get_naics_counts","selected_codes"], outputs: ["overall_plot_object"], body: async (counts_plot,get_naics_counts,selected_codes) => {
const overall_plot_object = counts_plot(await get_naics_counts(selected_codes, 0))
return {overall_plot_object};
}});

define({id: "1e565f07", inputs: ["plot_object"], outputs: ["legendScale"], body: (plot_object) => {
// Legend examples: https://observablehq.com/d/a23f6e59f1380df0
const legendScale = plot_object.scale("color")
return {legendScale};
}});

define({id: "5ef09846", inputs: ["d3","Plot","lookup_occ_title","lookup_naics_title"], outputs: ["counts_plot"], body: (d3,Plot,lookup_occ_title,lookup_naics_title) => {
const counts_plot = function(data) {
  const y_max = d3.max([...data], d => isNaN(+d.total_employment) ? -Infinity : +d.total_employment)
  const y_max_padding = y_max + 0.4 * y_max
  const grouping_limit_input = (new Set([...data].map((d) => d.NAICS))).size
  // const plot_height = ;
    return Plot.plot({
        style: {
          fontSize: 13,
        },
        // marginTop: 0,
        // paddingLeft: 1000,
        marginLeft: 75, 
        paddingLeft: 0,
        paddingRight: 0,
        // marginRight: 100, 
        // marginBottom: 30,
        // width: width,
        height: (parseInt(grouping_limit_input) == 1) ? 350: (165 * parseInt(grouping_limit_input) + 15),
        backgroundColor: "white",
        color: {
            // legend: true,
            // type: "diverging",
            legend: true
            // scheme: "tableau10"
        },
        legend: {
            tickFormat: lookup_occ_title,
        },
        // sort: {x: "-y"},
        x: {
          type: "band",
          label: null
        },
        y: {
          domain: [0, y_max_padding],
          axis: "left",
          grid: true,
          label: "Total Employment",
          // labelAnchor: "center",
          tickFormat: d3.format(".3s")
        },
        fy: {
          margin: 20,
          axis: null,
        },
        // style: "background: #777;",
        marks: [
            Plot.frame(),
            Plot.barY(data, {
                x: (d) => new Date(d.REPORT_DATE),
                y: "total_employment", 
                padding: 10,
                fill: (d) => lookup_naics_title(d.NAICS),
                tip: true,
                fy: "NAICS",
                sort: {y: "x", fy: "-y", order: "descending"},
                title: (d) => `${d3.timeFormat("%Y-%b")(new Date(d.REPORT_DATE))}\n\n${d.NAICS_TITLE}\n\nEmployment: ${d3.format(",")(d.total_employment)}\nNet Change (YoY): ${d3.format(",.0f")(d.change_since_previous)}\nChange (YoY %): ${d3.format(",.2f")(d.percent_change_since_previous)}%`
            }),
            Plot.rectY(data, Plot.pointer({
                x: (d) => new Date(d.REPORT_DATE),
                y: "total_employment", 
                fy: "NAICS", 
                stroke: "green",
                fill: "white",
                width: 10})
            ),
            // Plot.linearRegressionY(data, {x: (d) => new Date(d.REPORT_DATE), y: "total_employment", 
            //     fy: "NAICS", stroke: "red", width: 1}),
            Plot.axisX({textAnchor: "end", rotate: -90}),
            Plot.text(data, 
              Plot.selectFirst(
                {
                  text: "NAICS_TITLE", 
                  fy: "NAICS", 
                  frameAnchor: "top-left",
                  fontSize: 16,
                  fill: (d) => lookup_naics_title(d.NAICS),
                  // fill: "black",
                  stroke: "white",
                  backgroundColor: "black",
                  strokeWidth: 5,
                  dx: 5, 
                  dy: 6,
                }
              ),
            ),
            // Plot.text(data, {
            //   text: d => `${d3.format(".2s")(d.total_employment)}`,
            //   x: (d) => new Date(d.REPORT_DATE),
            //   y: "total_employment",
            //   textAnchor: "start",
            //   padding: 10,
            //   dx: 0,
            //   dy: -3,
            //   rotate: -90,
            //   fy: "NAICS",
            //   fill: "black",
            //   sort: {y: "x", order: "descending"},
            // }),
            Plot.text(data, {
              text: d => `${d3.format(".1f")(d.percent_change_since_previous)}%`,
              x: (d) => new Date(d.REPORT_DATE),
              y: "total_employment",
              textAnchor: "start",
              fontSize: 12,
              dx: -3,
              dy: -3,
              rotate: -60,
              fy: "NAICS",
              fill: (d) => (d.percent_change_since_previous) < 0 ? "red" : "black",
              sort: {y: "x", order: "descending"},
            }),
            Plot.ruleY([0])
        ]
    })}
return {counts_plot};
}});

define({id: "9975bf56", inputs: ["htl","d3"], outputs: ["sparkbar"], body: (htl,d3) => {
function sparkbar(max, d3_format_str) {
  return (x) => htl.html`<div style="
    background: #B9D9EB;
    color: black;
    font: 10px/1.6 var(--sans-serif);
    width: ${100 * x / max}%;
    float: right;
    padding-right: 5px;
    padding-left: 15px;
    box-sizing: border-box;
    overflow: visible;
    display: flex;
    justify-content: end;">${d3.format(d3_format_str)(x)}`
}
return {sparkbar};
}});

define({id: "47d73361", inputs: ["htl","d3"], outputs: ["sparkbarZeroCentered"], body: (htl,d3) => {
function sparkbarZeroCentered(min, max, d3_format_str) {
  const absMax = Math.max(Math.abs(min), Math.abs(max));

  return (x) => {
    const percentage = (Math.abs(x) / absMax) * 50; // 50% for positive, 50% for negative
    const isNegative = x < 0;
    
    return htl.html`<div style="
      position: relative;
      width: 100%;
      background: #f4f4f4;
      display: flex;
      align-items: center;
      justify-content: center;
      font: 10px/1.6 var(--sans-serif);
      color: black;
      box-sizing: border-box;
      overflow: hidden;">
      <div style="
        position: absolute;
        top: 0;
        right: 50%;
        width: ${isNegative ? percentage : 0}%;
        height: 100%;
        background: #ff9999;
        z-index: 1;
      "></div>
      <div style="
        position: absolute;
        top: 0;
        left: 50%;
        width: ${!isNegative ? percentage : 0}%;
        height: 100%;
        background: #99ff99;
        z-index: 1;
      "></div>
      <div style="
        position: absolute;
        top: 0;
        left: 50%;
        width: 2px;
        height: 100%;
        background: #999;
        z-index: 1;
      "></div>
      <span style="
        position: relative;
        z-index: 3;
        padding: 0 3px;
        background: rgba(255, 255, 255, 0.3);">
        ${d3.format(d3_format_str)(x)}
      </span>
    </div>`;
  };
}
return {sparkbarZeroCentered};
}});

define({id: "eb291491", inputs: ["get_naics_counts","selected_codes"], outputs: ["materialized_naics_counts"], body: async (get_naics_counts,selected_codes) => {
const materialized_naics_counts = [...await get_naics_counts(selected_codes)]
return {materialized_naics_counts};
}});

define({id: "db5f89da", inputs: ["materialized_naics_counts"], outputs: ["total_employment_numbers","percent_change_since_previous_numbers"], body: (materialized_naics_counts) => {
// For calculating max/min
const total_employment_numbers = materialized_naics_counts.map(d => d.total_employment);
const percent_change_since_previous_numbers = materialized_naics_counts.map(d => d.percent_change_since_previous);
return {total_employment_numbers,percent_change_since_previous_numbers};
}});

define({id: "ba896322", inputs: ["Inputs","get_naics_counts","selected_codes","sparkbar","d3","total_employment_numbers","sparkbarZeroCentered","percent_change_since_previous_numbers"], outputs: ["national_level_table"], body: async (Inputs,get_naics_counts,selected_codes,sparkbar,d3,total_employment_numbers,sparkbarZeroCentered,percent_change_since_previous_numbers) => {
const national_level_table = Inputs.table(await get_naics_counts(selected_codes), {
  format: {
      REPORT_DATE: (d) => new Date(d).toISOString().split('T')[0].split("-")[0],
      // total_employment: (d) => d3.format(",.0f")(d)
      total_employment: sparkbar(
        d3.max(total_employment_numbers), ",.0f"),
      percent_change_since_previous: sparkbarZeroCentered(
        d3.min(percent_change_since_previous_numbers), 
        d3.max(percent_change_since_previous_numbers), 
        ",.2f")
    },
    sort: "REPORT_DATE",
    reverse: true,
    // layout: "auto",
    width: {
      // AREA_TITLE: 40,
      REPORT_DATE: 30,
      NAICS_TITLE: 200,
      total_employment: 150,
      percent_change_since_previous: 60
    },
    align: {
      total_employment: "right",
    },
    columns: [
      "REPORT_DATE", 
      "NAICS_TITLE", 
      "total_employment", "percent_change_since_previous"],
    rows: 15,
    header: {
      AREA_TITLE: "State",
      REPORT_DATE: "Year",
      NAICS_TITLE: "Industry",
      total_employment: "Employment",
      percent_change_since_previous: "YoY ðš« (%)"
    }}
)
return {national_level_table};
}});

define({id: "b3b82386-2", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "fb7b5c3f", mode: "inline", inputs: ["national_level_table","display"], body: async (national_level_table,display) => {
display(await(
national_level_table
))
}});

define({id: "f0fa738e", outputs: ["sql_array_str"], body: () => {
const sql_array_str = function (code_array) {
    const selected_codes_str = "\'" + code_array.join("','") + "\'"
    return selected_codes_str
}
return {sql_array_str};
}});

define({id: "44d7df74", inputs: ["sql","sql_array_str"], outputs: ["naics_occ_state_counts"], body: (sql,sql_array_str) => {
const naics_occ_state_counts = async function (selected_codes, grouping_limit=5) {
  const occ_state_count_query = await sql([
    `WITH all_time_ranked_data AS (
    SELECT 
      AREA,
      AREA_TITLE,
      NAICS,
      ANY_VALUE(NAICS_TITLE) AS NAICS_TITLE,
      SUM(TOT_EMP) AS all_time_total_employment,
      RANK() OVER (PARTITION BY AREA, AREA_TITLE ORDER BY SUM(TOT_EMP) DESC) AS all_time_rank
    FROM oews_estimates
    WHERE OCC_CODE IN (${sql_array_str(selected_codes)}) 
      AND RIGHT(OCC_CODE, 1) != '0'
      AND LENGTH(NAICS) > 2
    GROUP BY AREA, AREA_TITLE, NAICS
),
top_x_naics AS (
    SELECT AREA, AREA_TITLE, NAICS
    FROM all_time_ranked_data
    WHERE all_time_rank <= ${grouping_limit}
),
monthly_data AS (
    SELECT 
      AREA,
      AREA_TITLE,
      REPORT_DATE,
      NAICS,
      ANY_VALUE(NAICS_TITLE) AS NAICS_TITLE,
      SUM(TOT_EMP) AS total_employment
    FROM oews_estimates
    WHERE OCC_CODE IN (${sql_array_str(selected_codes)}) 
      AND RIGHT(OCC_CODE, 1) != '0'
    GROUP BY AREA, AREA_TITLE, REPORT_DATE, NAICS
),
final_data AS (
    SELECT
      md.AREA,
      md.AREA_TITLE,
      md.REPORT_DATE,
      CASE 
        WHEN txn.NAICS IS NOT NULL THEN md.NAICS 
        ELSE 'Other'
      END AS NAICS,
      ANY_VALUE(CASE 
        WHEN txn.NAICS IS NOT NULL THEN md.NAICS_TITLE
        ELSE 'Other Industries'
      END) AS NAICS_TITLE,
      SUM(md.total_employment) AS total_employment
    FROM monthly_data md
    LEFT JOIN top_x_naics txn ON md.AREA = txn.AREA AND md.AREA_TITLE = txn.AREA_TITLE AND md.NAICS = txn.NAICS
    GROUP BY 
      md.AREA,
      md.AREA_TITLE,
      md.REPORT_DATE,
      CASE 
        WHEN txn.NAICS IS NOT NULL THEN md.NAICS 
        ELSE 'Other'
      END
),
final_data_with_changes AS (
    SELECT 
      fd.*,
      fd.total_employment - LAG(fd.total_employment) OVER (PARTITION BY fd.AREA, fd.AREA_TITLE, fd.NAICS ORDER BY fd.REPORT_DATE) AS change_since_previous,
      CASE 
        WHEN LAG(fd.total_employment) OVER (PARTITION BY fd.AREA, fd.AREA_TITLE, fd.NAICS ORDER BY fd.REPORT_DATE) = 0 THEN NULL
        ELSE (fd.total_employment - LAG(fd.total_employment) OVER (PARTITION BY fd.AREA, fd.AREA_TITLE, fd.NAICS ORDER BY fd.REPORT_DATE)) / LAG(fd.total_employment) OVER (PARTITION BY fd.AREA, fd.AREA_TITLE, fd.NAICS ORDER BY fd.REPORT_DATE) * 100
      END AS percent_change_since_previous
    FROM final_data fd
)
SELECT 
  AREA,
  AREA_TITLE,
  REPORT_DATE,
  NAICS,
  NAICS_TITLE,
  total_employment,
  change_since_previous,
  ROUND(percent_change_since_previous, 2) AS percent_change_since_previous,
FROM final_data_with_changes
ORDER BY 
  AREA,
  AREA_TITLE,
  REPORT_DATE,
  CASE WHEN NAICS = 'Other' THEN 2 ELSE 1 END,
  total_employment DESC`
  ])
  return occ_state_count_query
}
return {naics_occ_state_counts};
}});

define({id: "4ffdb7b3", inputs: ["naics_occ_state_counts","selected_codes","grouping_limit"], outputs: ["occ_state_counts"], body: async (naics_occ_state_counts,selected_codes,grouping_limit) => {
const occ_state_counts = await naics_occ_state_counts(selected_codes, grouping_limit)
return {occ_state_counts};
}});

define({id: "79a6e720", inputs: ["FileAttachment"], outputs: ["us"], body: (FileAttachment) => {
const us = FileAttachment("./dataloaders/counties-10m.json").json();
return {us};
}});

define({id: "f1183f46", inputs: ["topojson","us","occ_state_counts"], outputs: ["statemesh","fips_map_state_employment"], body: (topojson,us,occ_state_counts) => {
const statemesh = topojson.mesh(us, us.objects.states, (a, b) => a !== b)
const fips_map_state_employment = [...occ_state_counts].map((d) => [String(d.AREA).padStart(2, '0'), d.NAICS, d.total_employment,
  d.REPORT_DATE])
return {statemesh,fips_map_state_employment};
}});

define({id: "a6d46289", inputs: ["occ_state_counts"], outputs: ["unique_states"], body: (occ_state_counts) => {
const unique_states = [...new Set([...occ_state_counts].map((d) => d.AREA))]
return {unique_states};
}});

define({id: "4585941f", inputs: ["Inputs","unique_states","htl","lookup_state_name"], outputs: ["unique_states_selector"], body: (Inputs,unique_states,htl,lookup_state_name) => {
const unique_states_selector = Inputs.select(unique_states, {
  multiple: false, 
  label: htl.html`<div style="border-bottom: 1px solid lightgray"><span class="muted">Select a State</span></div>`,
  format: lookup_state_name}
);
return {unique_states_selector};
}});

define({id: "f0220d9d", inputs: ["Generators","unique_states_selector"], outputs: ["unique_states_selector_str"], body: (Generators,unique_states_selector) => {
const unique_states_selector_str = Generators.input(unique_states_selector)
return {unique_states_selector_str};
}});

define({id: "0c469820", inputs: ["occ_state_counts","unique_states_selector_str"], outputs: ["total_employment_numbers_state","percent_change_since_previous_numbers_state"], body: (occ_state_counts,unique_states_selector_str) => {
// For calculating max/min
const total_employment_numbers_state = [...occ_state_counts].filter(d => d.AREA == unique_states_selector_str).map(d => d.total_employment);
const percent_change_since_previous_numbers_state = [...occ_state_counts].filter(d => d.AREA == unique_states_selector_str).map(d => d.percent_change_since_previous);
return {total_employment_numbers_state,percent_change_since_previous_numbers_state};
}});

define({id: "b6d100f0", inputs: ["occ_state_counts","unique_states_selector_str"], outputs: ["state_counts"], body: async (occ_state_counts,unique_states_selector_str) => {
const state_counts = await [...occ_state_counts].filter((d) => (d.AREA == unique_states_selector_str))
return {state_counts};
}});

define({id: "ef209ce5", inputs: ["Inputs","state_counts","lookup_naics_title","htl","view"], outputs: ["state_naics_select","state_naics_select_arr"], body: (Inputs,state_counts,lookup_naics_title,htl,view) => {
const state_naics_select = Inputs.select(
  [...new Set(state_counts.map(d => d.NAICS))], 
  { 
    value: [...new Set(state_counts.map(d => d.NAICS))],
    multiple: true,
    format: lookup_naics_title,
    label: htl.html`<div style="border-bottom: 1px solid lightgray"><span class="muted">Filter by Industry<br>Ctrl (âŒ˜) + Click to Choose Multiple</span></div>`,
    width: 300
  }
)
const state_naics_select_arr = view(state_naics_select)
return {state_naics_select,state_naics_select_arr};
}});

define({id: "78d7ad3e", inputs: ["Inputs","state_counts","state_naics_select_arr","sparkbar","d3","total_employment_numbers_state","sparkbarZeroCentered","percent_change_since_previous_numbers_state"], outputs: ["state_table"], body: (Inputs,state_counts,state_naics_select_arr,sparkbar,d3,total_employment_numbers_state,sparkbarZeroCentered,percent_change_since_previous_numbers_state) => {
const state_table = Inputs.table(state_counts.filter((d)=>state_naics_select_arr.includes(d.NAICS)), {
    format: {
      REPORT_DATE: (d) => new Date(d).toISOString().split('T')[0].split("-")[0],
      total_employment: sparkbar(
        d3.max(total_employment_numbers_state), ",.0f"),
      percent_change_since_previous: sparkbarZeroCentered(
        d3.min(percent_change_since_previous_numbers_state), 
        d3.max(percent_change_since_previous_numbers_state), 
        ",.2f")
    },
    sort: "REPORT_DATE",
    reverse: true,
    // layout: "auto",
    width: {
      // AREA_TITLE: 40,
      REPORT_DATE: 40,
      // NAICS_TITLE: 200,
      total_employment: 100,
      percent_change_since_previous: 70
    },
    align: {
      total_employment: "right",
      REPORT_DATE: "left"
    },
    columns: ["REPORT_DATE", 
      // "NAICS", 
      "NAICS_TITLE", "total_employment", "percent_change_since_previous"],
    rows: 26,
    header: {
      AREA_TITLE: "State",
      REPORT_DATE: "Year",
      NAICS_TITLE: "Industry",
      total_employment: "Employment",
      percent_change_since_previous: "YoY ðš« (%)"
    }
})
return {state_table};
}});

define({id: "4f1f9152", inputs: ["counts_plot","occ_state_counts","unique_states_selector_str"], outputs: ["state_trends_plot"], body: async (counts_plot,occ_state_counts,unique_states_selector_str) => {
const state_trends_plot = counts_plot(await [...occ_state_counts].filter((d) => (d.AREA == unique_states_selector_str)))
return {state_trends_plot};
}});

define({id: "dbc3637a", mode: "inline", inputs: ["unique_states_selector","display"], body: async (unique_states_selector,display) => {
display(await(
unique_states_selector
))
}});

define({id: "b3b82386-3", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "6c9b9d48", mode: "inline", inputs: ["lookup_state_name","unique_states_selector_str","display"], body: async (lookup_state_name,unique_states_selector_str,display) => {
display(await(
lookup_state_name(unique_states_selector_str)
))
}});

define({id: "89480773", mode: "inline", inputs: ["state_trends_plot","display"], body: async (state_trends_plot,display) => {
display(await(
state_trends_plot
))
}});

define({id: "b3b82386-4", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "6c9b9d48-1", mode: "inline", inputs: ["lookup_state_name","unique_states_selector_str","display"], body: async (lookup_state_name,unique_states_selector_str,display) => {
display(await(
lookup_state_name(unique_states_selector_str)
))
}});

define({id: "2e23893d", mode: "inline", inputs: ["state_naics_select","display"], body: async (state_naics_select,display) => {
display(await(
state_naics_select
))
}});

define({id: "59264921", mode: "inline", inputs: ["state_table","display"], body: async (state_table,display) => {
display(await(
state_table
))
}});

define({id: "beee61fd", outputs: ["processData"], body: () => {
function processData(rows) {
  return rows.map(row => {
      const date = new Date(row.REPORT_DATE);
      return {
      fips: row.AREA.toString().padStart(2, '0'),
      state: row.AREA_TITLE,
      date: date,
      year: date.getFullYear(),
      naics: row.NAICS,
      naicsTitle: row.NAICS_TITLE,
      employment: row.total_employment,
      changeSincePrevious: row.change_since_previous,
      percentChangeSincePrevious: row.percent_change_since_previous
      };
  });
}
return {processData};
}});

define({id: "cabbd872", inputs: ["topojson","us","processData","occ_state_counts"], outputs: ["states","filteredData","mergedFeatures"], body: async (topojson,us,processData,occ_state_counts) => {
const states = topojson.feature(us, us.objects.states);

// Filter data for the specific NAICS code
// const filteredData = processedData.filter((d) => d.naics == "611000");
const filteredData = processData(await [...occ_state_counts]);

// Merge data with topojson features
const mergedFeatures = states.features.map(feature => {
    const stateData = filteredData.filter(d => d.fips === feature.id);
    return { ...feature, properties: { ...feature.properties, data: stateData } };
  });
return {states,filteredData,mergedFeatures};
}});

define({id: "44885952", inputs: ["occ_state_counts"], outputs: ["report_year"], body: (occ_state_counts) => {
const report_year = [...new Set([...occ_state_counts].map((d) => new Date(d.REPORT_DATE).getFullYear()))]
return {report_year};
}});

define({id: "fb036afb", inputs: ["Inputs","report_year","d3","htl"], outputs: ["report_year_input"], body: (Inputs,report_year,d3,htl) => {
const report_year_input = Inputs.select(
  report_year, 
  {
    multiple: false, 
    value: report_year, 
    sort: "descending", 
    format: d3.format(".0f"),
    label: htl.html`<div style="border-bottom: 1px solid lightgray"><span class="muted">Report Year</span></div>`,
    width: 120
  }
);
return {report_year_input};
}});

define({id: "427d8d4b", inputs: ["Generators","report_year_input"], outputs: ["report_year_input_str"], body: (Generators,report_year_input) => {
const report_year_input_str = Generators.input(report_year_input)
return {report_year_input_str};
}});

define({id: "797a3dff", inputs: ["mergedFeatures","report_year_input_str"], outputs: ["mergedFeaturesData","yearData"], body: (mergedFeatures,report_year_input_str) => {
const mergedFeaturesData = mergedFeatures.map(d => d.properties.data).flat()
const yearData = mergedFeaturesData.filter(item => item.year == parseInt(report_year_input_str))
return {mergedFeaturesData,yearData};
}});

define({id: "00149eb2", body: () => {
// const top_naics = [...new Set([...occ_state_counts].filter((d) => new Date(d.REPORT_DATE).getFullYear()==parseInt(report_year_input_str)).map((d) => d.NAICS))]
// const top_naics = [...new Set([...occ_state_counts].filter((d)=>![78,66].includes(d.AREA)).map((d) => d.NAICS))]
}});

define({id: "85b2195e", inputs: ["aq","occ_state_counts"], outputs: ["top_naics"], body: (aq,occ_state_counts) => {
// Group by category and sum values
const top_naics = aq.from([...occ_state_counts])
  .filter((d)=>![78,66].includes(d.AREA))
  .groupby('AREA', "NAICS", "REPORT_DATE")
  .count()
  .groupby('NAICS')
  .count()
  .filter(d => d.count > 50)
  .objects()
  .map(d => d.NAICS);
return {top_naics};
}});

define({id: "bef7d7aa", inputs: ["Inputs","top_naics","lookup_naics_title","htl"], outputs: ["selected_naics"], body: (Inputs,top_naics,lookup_naics_title,htl) => {
const selected_naics = Inputs.select(
  top_naics, 
  {
    multiple: false, 
    value: top_naics, 
    sort: "ascending", 
    format: lookup_naics_title,
    label: htl.html`<div style="border-bottom: 1px solid lightgray"><span class="muted">Industry</span></div>`,
    // width: 400
  }
);
return {selected_naics};
}});

define({id: "a7c6f45f", inputs: ["Generators","selected_naics"], outputs: ["selected_naics_str"], body: (Generators,selected_naics) => {
const selected_naics_str = Generators.input(selected_naics)
return {selected_naics_str};
}});

define({id: "f194d9b5", inputs: ["yearData","selected_naics_str"], outputs: ["employment_mapping"], body: (yearData,selected_naics_str) => {
// This is really lazy way to do this, but other methods make it really complicated
const employment_mapping = new Map(yearData.filter(d => d.naics == selected_naics_str).map(d => [d.fips, d.employment]))
return {employment_mapping};
}});

define({id: "89338939", inputs: ["yearData","selected_naics_str"], outputs: ["naics_mapping"], body: (yearData,selected_naics_str) => {
const naics_mapping = new Map(yearData.filter(d => d.naics == selected_naics_str).map(d => [d.fips, d.naicsTitle]))
return {naics_mapping};
}});

define({id: "20821247", inputs: ["yearData","selected_naics_str"], outputs: ["delta_change_mapping"], body: (yearData,selected_naics_str) => {
const delta_change_mapping = new Map(yearData.filter(d => d.naics == selected_naics_str).map(d => [d.fips, d.percentChangeSincePrevious]))
return {delta_change_mapping};
}});

define({id: "eebc51ed", inputs: ["yearData","selected_naics_str"], outputs: ["delta_change_n_mapping"], body: (yearData,selected_naics_str) => {
const delta_change_n_mapping = new Map(yearData.filter(d => d.naics == selected_naics_str).map(d => [d.fips, d.changeSincePrevious]))
return {delta_change_n_mapping};
}});

define({id: "f17f348c", inputs: ["topojson","us"], outputs: ["nation"], body: (topojson,us) => {
const nation = topojson.feature(us, us.objects.nation)
return {nation};
}});

define({id: "678b8e17", inputs: ["Plot","d3","mergedFeatures","employment_mapping","delta_change_n_mapping","naics_mapping","getStateAbbreviation","nation","statemesh"], outputs: ["employment_map"], body: (Plot,d3,mergedFeatures,employment_mapping,delta_change_n_mapping,naics_mapping,getStateAbbreviation,nation,statemesh) => {
const employment_map = function () {
  return Plot.plot({
  margin: 0,
  padding: 0,
  projection: "albers-usa",
  color: {
    type: "quantize",
    scheme: "blues",
    label: "Employment (n)",
    legend: true,
    tickFormat: d3.format(".2s"),
    width: 300
  },
  marks: [
    Plot.geo(mergedFeatures, Plot.centroid({
      fill: (d) => employment_mapping.get(d.id),
      tip: true,
      channels: {
        Change: d => delta_change_n_mapping.get(d.id),
        Industry: d => naics_mapping.get(d.id),
      },
    })),
    Plot.text(mergedFeatures, Plot.centroid({text: (d) => getStateAbbreviation(d.properties.name), fill: "currentColor", stroke: "white"})),
    Plot.geo(nation),
    Plot.geo(statemesh, {stroke: "gray"})
  ]
})
}
return {employment_map};
}});

define({id: "81ff53d7", inputs: ["Plot","d3","mergedFeatures","delta_change_mapping","delta_change_n_mapping","naics_mapping","nation","getStateAbbreviation","statemesh"], outputs: ["delta_change_map"], body: (Plot,d3,mergedFeatures,delta_change_mapping,delta_change_n_mapping,naics_mapping,nation,getStateAbbreviation,statemesh) => {
const delta_change_map = function (){
  return Plot.plot({
    margin: 0,
    padding: 0,
    projection: "albers-usa",
    color: {
      type: "diverging",
      scheme: "brbg",
      label: "Change since Previous Year (%)",
      legend: true,
      pivot: 0,
      tickFormat: d3.format(".1f"),
      symmetry: true,
      width: 300
    },
    marks: [
      Plot.geo(mergedFeatures, Plot.centroid({
        fill: (d) => delta_change_mapping.get(d.id),
        tip: true,
        stroke: "white",
        channels: {
          State: d => d.name,
          Change: d => delta_change_n_mapping.get(d.id),
          Industry: d => naics_mapping.get(d.id),
        }
      })),
      Plot.geo(nation),
      Plot.text(mergedFeatures, Plot.centroid({
        text: (d) => `${getStateAbbreviation(d.properties.name)}`, 
        fill: "gray", 
        stroke: "white",
        fontSize: 10,
        strokeWidth: 2,
      })),
      Plot.text(mergedFeatures, Plot.centroid({
        text: (d) => `\n${d3.format("0.1f")(delta_change_mapping.get(d.id))}%`, 
        fill: (d) => delta_change_mapping.get(d.id) > 0 ? "blue" : "red", 
        stroke: "white",
        dy: 8,
        fontSize: 13,
        strokeWidth: 2,
        strokeOpacity: (d) => delta_change_mapping.get(d.id) > 0 ? 0.1 : 0.6
      })),
      // Plot.spike(
      //   mergedFeatures,
      //   Plot.centroid({
      //     anchor: "middle",
      //     dx: -28,
      //     dy: 6,
      //     length: 7,
      //     stroke: (d) => delta_change_mapping.get(d.id) > 0 ? "darkgreen" : "red",
      //     rotate: (d) => delta_change_mapping.get(d.id) > 0 ? 0 : -180
      //   })
      // ),
      Plot.geo(statemesh, {stroke: "gray"}),
    ]
  })
}
return {delta_change_map};
}});

define({id: "579b63cf", inputs: ["report_year_input","display"], body: async (report_year_input,display) => {
display(await(
report_year_input
))
}});

define({id: "03f1d4b0", inputs: ["selected_naics","display"], body: async (selected_naics,display) => {
display(await(
selected_naics
))
}});

define({id: "b3b82386-5", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "e2c6acdc", mode: "inline", inputs: ["lookup_naics_title","selected_naics_str","display"], body: async (lookup_naics_title,selected_naics_str,display) => {
display(await(
lookup_naics_title(selected_naics_str)
))
}});

define({id: "8236c32c", mode: "inline", inputs: ["report_year_input_str","display"], body: async (report_year_input_str,display) => {
display(await(
report_year_input_str
))
}});

define({id: "5ca59dc5", mode: "inline", inputs: ["employment_map","display"], body: async (employment_map,display) => {
display(await(
employment_map()
))
}});

define({id: "b3b82386-6", mode: "inline", inputs: ["selected_codes_hash","display"], body: async (selected_codes_hash,display) => {
display(await(
selected_codes_hash.name
))
}});

define({id: "e2c6acdc-1", mode: "inline", inputs: ["lookup_naics_title","selected_naics_str","display"], body: async (lookup_naics_title,selected_naics_str,display) => {
display(await(
lookup_naics_title(selected_naics_str)
))
}});

define({id: "8236c32c-1", mode: "inline", inputs: ["report_year_input_str","display"], body: async (report_year_input_str,display) => {
display(await(
report_year_input_str
))
}});

define({id: "76583df1", mode: "inline", inputs: ["delta_change_map","display"], body: async (delta_change_map,display) => {
display(await(
delta_change_map()
))
}});

define({id: "fee9f60a", outputs: ["stateAbbreviations","getStateAbbreviation"], body: () => {
// Object mapping state names to their abbreviations
const stateAbbreviations = {
  'Alabama': 'AL',
  'Alaska': 'AK',
  'Arizona': 'AZ',
  'Arkansas': 'AR',
  'California': 'CA',
  'Colorado': 'CO',
  'Connecticut': 'CT',
  'Delaware': 'DE',
  'Florida': 'FL',
  'Georgia': 'GA',
  'Hawaii': 'HI',
  'Idaho': 'ID',
  'Illinois': 'IL',
  'Indiana': 'IN',
  'Iowa': 'IA',
  'Kansas': 'KS',
  'Kentucky': 'KY',
  'Louisiana': 'LA',
  'Maine': 'ME',
  'Maryland': 'MD',
  'Massachusetts': 'MA',
  'Michigan': 'MI',
  'Minnesota': 'MN',
  'Mississippi': 'MS',
  'Missouri': 'MO',
  'Montana': 'MT',
  'Nebraska': 'NE',
  'Nevada': 'NV',
  'New Hampshire': 'NH',
  'New Jersey': 'NJ',
  'New Mexico': 'NM',
  'New York': 'NY',
  'North Carolina': 'NC',
  'North Dakota': 'ND',
  'Ohio': 'OH',
  'Oklahoma': 'OK',
  'Oregon': 'OR',
  'Pennsylvania': 'PA',
  'Rhode Island': 'RI',
  'South Carolina': 'SC',
  'South Dakota': 'SD',
  'Tennessee': 'TN',
  'Texas': 'TX',
  'Utah': 'UT',
  'Vermont': 'VT',
  'Virginia': 'VA',
  'Washington': 'WA',
  'West Virginia': 'WV',
  'Wisconsin': 'WI',
  'Wyoming': 'WY'
};

// Function to look up state abbreviation
function getStateAbbreviation(stateName) {
  // Convert input to title case for consistency
  const formattedStateName = stateName.replace(/\w\S*/g, 
    txt => txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
  
  return stateAbbreviations[formattedStateName] || 'Not Found';
}

// Example usage
console.log(getStateAbbreviation('California')); // Outputs: CA
console.log(getStateAbbreviation('new york')); // Outputs: NY
console.log(getStateAbbreviation('Unknown State')); // Outputs: Not Found
return {stateAbbreviations,getStateAbbreviation};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Clinicians.fyi</a></li>
  </ol>
  <details open>
    <summary>Healthcare Fraud</summary>
    <ol>
    <li class="observablehq-link"><a href="./healthcare-fraud">Criminal Cases</a></li>
    <li class="observablehq-link"><a href="./healthcare-fraud-startups">Startups/Health Tech</a></li>
    </ol>
  </details>
  <details open class="observablehq-section-active">
    <summary>Labor</summary>
    <ol>
    <li class="observablehq-link"><a href="./healthcare-labor">Healthcare Labor Statistics</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./healthcare-labor-v2">Healthcare Labor Statistics V2</a></li>
    <li class="observablehq-link"><a href="./occupation-search">Occupation Explorer</a></li>
    </ol>
  </details>
  <details open>
    <summary>Hospital Ownership</summary>
    <ol>
    <li class="observablehq-link"><a href="./pe_hospitals">PE Hospitals Tracker</a></li>
    </ol>
  </details>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type)[id], h2:first-child[id], :not(h1) + h2[id]">
<nav>
<div>Contents</div>
<ol>
<li class="observablehq-secondary-link"><a href="#national-level%3A-table">National-level: Table</a></li>
<li class="observablehq-secondary-link"><a href="#state-level%3A-trends">State-Level: Trends</a></li>
<li class="observablehq-secondary-link"><a href="#state-level%3A-map">State-Level: Map</a></li>
<li class="observablehq-secondary-link"><a href="#references">References</a></li>
<li class="observablehq-secondary-link"><a href="#feedback">Feedback</a></li>
</ol>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="healthcare-labor-trends-v2" tabindex="-1"><a class="observablehq-header-anchor" href="#healthcare-labor-trends-v2">Healthcare Labor Trends V2</a></h1>
<hr style="padding: 0">
<div class="observablehq observablehq--block"><!--:ba6a16f1:--></div>
<div class="observablehq observablehq--block"><!--:520c85fa:--></div>
<div class="observablehq observablehq--block"><!--:42afef24:--></div>
<div class="observablehq observablehq--block"><!--:c0d0c1a5:--></div>
<div class="observablehq observablehq--block"><!--:c4f6bdfb:--></div>
<!-- ## Search Occupation -->
<!-- Bureau of Labor Statistics uses "OCC" codes to capture occupations in the U.S. for reporting purposes. Full list is here: https://www.bls.gov/oes/current/oes_stru.htm -->
<div class="observablehq observablehq--block"><!--:7e6c1cf3:--></div>
<div class="observablehq observablehq--block"><!--:2fa41573:--></div>
<div class="observablehq observablehq--block"><!--:8001c005:--></div>
<div class="observablehq observablehq--block"><!--:250a25eb:--></div>
<div class="observablehq observablehq--block"><!--:7c75a881:--></div>
<h2> National-level Trends</h2>
<p>Bureau of Labor Statistics (BLS) releases annual report via <a href="https://www.bls.gov/oes/" target="_blank" rel="noopener noreferrer">Occupational Employment and Wage Statistics (OEWS)</a> program. In May every year BLS releases aggregated information for the previous calendar year. The data presented here should match the Excel tables from <a href="https://www.bls.gov/oes/tables.htm" target="_blank" rel="noopener noreferrer">OEWS Reports</a>.</p>
<div class="observablehq observablehq--block"><!--:fdda96c3:--></div>
<div class="observablehq observablehq--block"><!--:6941ebb8:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:43344edb:--></div>
<div class="observablehq observablehq--block"><!--:f93bf5b7:--></div>
<div class="observablehq observablehq--block"><!--:9f6856b4:--></div>
<div class="observablehq observablehq--block"><!--:4ab5ef7d:--></div>
<div class="healthcare-occ">
<observablehq-loading></observablehq-loading><!--:2bbffbab:-->
</div>
<div class="card grid grid-cols-4" style="padding: 0;  overflow:hidden;">
  <div class="card grid-colspan-1" style="border: 0px; border-right: 1px solid #eee; border-radius: 0;">
    <h1><span style="font-weight: bold">Classification</span></h1>
    <span class="muted">Click for detailed BLS page</span>
    <hr style="padding: 0px; margin-top: 10px">
    <observablehq-loading></observablehq-loading><!--:69b75b06:-->
  </div>
  <div class="card  grid-colspan-3" style="border: 0px;">
    <h1 style="border-bottom: 3px solid red;
          color: #444;
          padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386:--></h1>
    <h1><span style="font-weight: normal;">Nationwide</span> Trends, Overall</h1>
    Employment over time (Label in <b>Percent (%) change</b> year-over-year)
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:cc2bfbd3:-->
    <hr style="padding: 0px; margin-top: 10px">
    <h1 style="border-bottom: 3px solid red;
          color: #444;
          padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386-1:--></h1>
    <h1><span style="font-weight: normal;">Nationwide</span> Trends, By Industries</h1>
    Employment over time (Label in <b>Percent (%) change</b> year-over-year)
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:933fdb9a:-->
  </div>
</div>
<div class="observablehq observablehq--block"><!--:686c2ab9:--></div>
<div class="observablehq observablehq--block"><!--:ea6a5532:--></div>
<div class="observablehq observablehq--block"><!--:1e565f07:--></div>
<p><span class="align: right">Source: Bureau of Labor Statistics</span></p>
<div class="observablehq observablehq--block"><!--:5ef09846:--></div>
<hr>
<h2 id="national-level%3A-table" tabindex="-1"><a class="observablehq-header-anchor" href="#national-level%3A-table">National-level: Table</a></h2>
<div class="observablehq observablehq--block"><!--:9975bf56:--></div>
<div class="observablehq observablehq--block"><!--:47d73361:--></div>
<div class="observablehq observablehq--block"><!--:eb291491:--></div>
<div class="observablehq observablehq--block"><!--:db5f89da:--></div>
<div class="observablehq observablehq--block"><!--:ba896322:--></div>
<h1 style="border-bottom: 3px solid red;
      color: #444;
      padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386-2:--></h1>
<div class="card" style="padding: 1px 0px; overflow: hidden;">
<observablehq-loading></observablehq-loading><!--:fb7b5c3f:-->
</div>
<hr>
<div class="observablehq observablehq--block"><!--:f0fa738e:--></div>
<div class="observablehq observablehq--block"><!--:44d7df74:--></div>
<div class="observablehq observablehq--block"><!--:4ffdb7b3:--></div>
<div class="observablehq observablehq--block"><!--:79a6e720:--></div>
<div class="observablehq observablehq--block"><!--:f1183f46:--></div>
<div class="observablehq observablehq--block"><!--:a6d46289:--></div>
<div class="observablehq observablehq--block"><!--:4585941f:--></div>
<div class="observablehq observablehq--block"><!--:f0220d9d:--></div>
<h2 id="state-level%3A-trends" tabindex="-1"><a class="observablehq-header-anchor" href="#state-level%3A-trends">State-Level: Trends</a></h2>
<p>State-level data is derived from <strong>OEWS Research Estimates</strong>: <a href="https://www.bls.gov/oes/current/oes_research_estimates.htm" target="_blank" rel="noopener noreferrer">https://www.bls.gov/oes/current/oes_research_estimates.htm</a>.</p>
<p>Disclaimer from the site:
"The OEWS program provides wage and employment estimates by state and industry beginning with the May 2012 reference period. These estimates are intended for research purposes, and users should be aware of the limitations of the data."</p>
<p>NAICS categorizes the state-level data more higher level than the national-level. For example <b>Hospitals</b> (622000) category mainly overlaps with <b>General Medical and Surgical Hospitals</b> (622100).</p>
<div class="observablehq observablehq--block"><!--:0c469820:--></div>
<div class="observablehq observablehq--block"><!--:b6d100f0:--></div>
<div class="observablehq observablehq--block"><!--:ef209ce5:--></div>
<div class="observablehq observablehq--block"><!--:78d7ad3e:--></div>
<div class="observablehq observablehq--block"><!--:4f1f9152:--></div>
<div style="padding: 0px; padding-bottom"><observablehq-loading></observablehq-loading><!--:dbc3637a:--></div>
<div class="grid grid-cols-4">
  <div class="card grid-colspan-2">
    <h1 style="border-bottom: 3px solid red;
          color: #444;
          padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386-3:--></h1>
    <h1><span style="font-weight: normal;">Trends:</span> <observablehq-loading></observablehq-loading><!--:6c9b9d48:--></h1>
    Employment over time (Label in % change year-over-year)
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:89480773:-->
  </div>
  <div class="card grid-colspan-2">
  <h1 style="border-bottom: 3px solid red;
        color: #444;
        padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386-4:--></h1>
    <h1><span style="font-weight: normal;">Table:</span> <observablehq-loading></observablehq-loading><!--:6c9b9d48-1:--></h1>
    Employment over time (Label in % change year-over-year)
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:2e23893d:-->
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:59264921:-->
  </div>
</div>
<hr>
<h2 id="state-level%3A-map" tabindex="-1"><a class="observablehq-header-anchor" href="#state-level%3A-map">State-Level: Map</a></h2>
<div class="observablehq observablehq--block"><!--:beee61fd:--></div>
<div class="observablehq observablehq--block"><!--:cabbd872:--></div>
<div class="observablehq observablehq--block"><!--:44885952:--></div>
<div class="observablehq observablehq--block"><!--:fb036afb:--></div>
<div class="observablehq observablehq--block"><!--:427d8d4b:--></div>
<div class="observablehq observablehq--block"><!--:797a3dff:--></div>
<div class="observablehq observablehq--block"><!--:00149eb2:--></div>
<div class="observablehq observablehq--block"><!--:85b2195e:--></div>
<div class="observablehq observablehq--block"><!--:bef7d7aa:--></div>
<div class="observablehq observablehq--block"><!--:a7c6f45f:--></div>
<div class="observablehq observablehq--block"><!--:f194d9b5:--></div>
<div class="observablehq observablehq--block"><!--:89338939:--></div>
<div class="observablehq observablehq--block"><!--:20821247:--></div>
<div class="observablehq observablehq--block"><!--:eebc51ed:--></div>
<div class="observablehq observablehq--block"><!--:f17f348c:--></div>
<div class="observablehq observablehq--block"><!--:678b8e17:--></div>
<div class="observablehq observablehq--block"><!--:81ff53d7:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:579b63cf:--></div>
<div class="observablehq observablehq--block"><observablehq-loading></observablehq-loading><!--:03f1d4b0:--></div>
<div class="grid grid-cols-4">
  <div class="card grid-colspan-2">
    <h1 style="border-bottom: 3px solid red;
          font-size: 1.2rem;
          color: #444;
          padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386-5:--></h1>
    <h1 style="font-size: 1.6em; color: #444; font-weight: normal;"><observablehq-loading></observablehq-loading><!--:e2c6acdc:--></h1>
    <h2 style="font-weight: normal;"><observablehq-loading></observablehq-loading><!--:8236c32c:-->: <b>Total employment</b></h2>
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:5ca59dc5:-->
  </div>
  <div class="card grid-colspan-2">
    <h1 style="border-bottom: 3px solid red;
          font-size: 1.2rem;
          color: #444;
          padding-bottom: 1px;"><observablehq-loading></observablehq-loading><!--:b3b82386-6:--></h1>
    <h1 style="font-size: 1.6em; color: #444; font-weight: normal;"><observablehq-loading></observablehq-loading><!--:e2c6acdc-1:--></h1>
    <h2 style="font-weight: normal;"><observablehq-loading></observablehq-loading><!--:8236c32c-1:-->: <b>Percent (%) change over previous year</b></h2>
    <hr style="padding: 0px; margin-top: 10px"><observablehq-loading></observablehq-loading><!--:76583df1:-->
  </div>
</div>
<hr>
<h2 id="references" tabindex="-1"><a class="observablehq-header-anchor" href="#references">References</a></h2>
<ul>
<li><a href="https://www.bls.gov/oes/tables.htm" target="_blank" rel="noopener noreferrer">OEWS Date Tables</a></li>
<li><a href="https://www.bls.gov/oes/current/oes_research_estimates.htm" target="_blank" rel="noopener noreferrer">OEWS Research Estimates</a></li>
<li><a href="https://github.com/observablehq/framework" target="_blank" rel="noopener noreferrer">Observable Framework</a></li>
<li><a href="https://github.com/uwdata/arquero" target="_blank" rel="noopener noreferrer">Arquero</a></li>
</ul>
<hr>
<h2 id="feedback" tabindex="-1"><a class="observablehq-header-anchor" href="#feedback">Feedback</a></h2>
<ul>
<li>Comments, feedback, data issues?</li>
<li>Reach out on LinkedIn <a href="https://www.linkedin.com/in/jung-hoon-son/" target="_blank" rel="noopener noreferrer">@Jung Hoon Son</a></li>
</ul>
<div class="observablehq observablehq--block"><!--:fee9f60a:--></div>
</main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./healthcare-labor"><span>Healthcare Labor Statistics</span></a><a rel="next" href="./occupation-search"><span>Occupation Explorer</span></a></nav>
<div>Built with Observable.</div>
</footer>
</div>
